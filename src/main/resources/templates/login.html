<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <input type="hidden" id="_csrf" th:value="${_csrf}">
</head>
<body>
  <input type="email" id="email"><br/>
  <input type="password" id="password"><br/>
  <button id="btn-login" type="button">登录</button>
  <script src="/static/js/jquery.min.js"></script>
  <script>
    $('#btn-login').click(function() {
      let email = $('#email').val()
      let password = $('#password').val()
      if(email === null || email.trim().length === 0) {
        alert('请输入邮箱')
        return
      }
      if(password === null || password.trim().length === 0) {
        alert('请输入密码')
        return
      }
      let data = {'email':email, 'password': password}

      let loginUrl = '/api/login'
      $.ajax({
        url: loginUrl,
        dataType: 'json',
        contentType: 'application/json;charset=utf8',
        headers: {
          '_csrf-token': $('#_csrf').val()
        },
        data: JSON.stringify(data),
        method: 'POST',
        success: function() {
          window.location.href = '/console/articles'
        },
        error: function(xhrRequest, error, thrown) {
          alert('登陆失败' + error)
        }
      })
    })

    function getQueryParam(key) {
      let queryStr = window.location.search.substring(1)
      let arrs = queryStr.split('&')
      for(let i= 0; i < arrs.length; i++) {
        let pair = arrs[i].split('=')
        if (pair[0] === key) {
          return pair[1]
        }
      }
    }
  </script>
</body>
</html>